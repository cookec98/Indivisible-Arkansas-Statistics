@page
@model IndivisibleArk.Pages.Contacts.IndexModel

@{
    ViewData["Title"] = "Contacts";
}

<h1>Contacts</h1>
<p></p>
<h2 class="create_new_link">
    @* make bigger, more obvious *@
    <a asp-page="Create">Create New</a>
</h2>
<form asp-page="./Index" method="get">
    <div class="form-actions no-color">
        <p>
            Find by name:
            <input type="text" name="SearchString" value="@Model.CurrentFilter" />
            <input type="submit" value="Search" class="btn btn-primary" /> |
            <a asp-page="./Index">Back to full List</a>
        </p>
    </div>
</form>
<p></p>
<div class="row align-items-start">
    <div class="col-9">
        <table class="table">
            <thead>
                <tr>
                    <th>
                        <a asp-page="./Index" asp-route-sortOrder="@Model.NameSort">
                            @Html.DisplayNameFor(model => model.Contact[0].F_name)
                        </a>
                    </th>
                    @*
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].M_name)
                        </th>
                    *@
                    <th>
                        @Html.DisplayNameFor(model => model.Contact[0].L_name)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Contact[0].Email)
                    </th>
                    @*

                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].Address)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].M_address)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].Apt_lot_no)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].City)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].County)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].State)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].DOB)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].P_aff)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].Precinct)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].Phone)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].Zip)
                        </th>
                    *@
                <th>
                    <a asp-page="./Index" asp-route-sortOrder="@Model.DateSort">
                        @Html.DisplayNameFor(model => model.Contact[0].Registration)
                    </a>
                </th>

                    @*
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].Location)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Contact[0].Interest)
                        </th>
                    *@

                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Contact)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.F_name)
                        </td>
                        @*
                            <td>
                                @Html.DisplayFor(modelItem => item.M_name)
                            </td>
                        *@
                        <td>
                            @Html.DisplayFor(modelItem => item.L_name)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Email)
                        </td>
                        @*

                            <td>
                                @Html.DisplayFor(modelItem => item.Address)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.M_address)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Apt_lot_no)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.City)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.County)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.State)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.DOB)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.P_aff)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Precinct)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Phone)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Zip)
                            </td>
                        *@
                        <td>
                            @Html.DisplayFor(modelItem => item.Registration)
                        </td>
                        @*
                            <td>
                                @Html.DisplayFor(modelItem => item.Location.LocationId)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Interest.InterestId)
                            </td>
                        *@

                    <td>
                        <a asp-page="./Edit" asp-route-id="@item.ContactId">Edit</a> |
                        <a asp-page="./Details" asp-route-id="@item.ContactId">Details</a> |
                        <a asp-page="./Delete" asp-route-id="@item.ContactId">Delete</a>

                        <script>console.log("iterated " + "@item.ContactId");</script>
                        @Html.Hidden("contIDNum", item.ContactId)
                        <button id='view_btn' onclick="ViewFunction(@item.ContactId)">View</button>
                    </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="col-3 index-details">
        <ul id="info_view"></ul>
        <div>
            <a class="nav-link gen_script" asp-page="/Scripts/Index">Generate a Script</a>
        </div>
    </div>
</div>


@section Scripts {

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>function ViewFunction(conID) {

            console.log("clicked contact "+ conID + " button.");

            //run a for loop?

            $.ajax({
                url: '/Contacts/Filter',
                data: {
                    Contact: conID
                }
            })
                .done(function (result) {

                    $("#info_view").empty();
                    $("#info_view").append("<li> First Name: "+result[0].f_name+"</li>");
                    $("#info_view").append("<li> Middle Name: "+result[0].m_name+"</li>");
                    $("#info_view").append("<li> Last Name: " + result[0].l_name + "</li>");
                    $("#info_view").append("<li> Email: "+result[0].email+"</li>");
                    $("#info_view").append("<li> Address: " + result[0].address + "</li>");
                    $("#info_view").append("<li> Mailing Address: " + result[0].M_address + "</li>");
                    $("#info_view").append("<li> Apartment Number: " + result[0].apt_lot_no + "</li>");
                    $("#info_view").append("<li> City: " + result[0].city + "</li>");
                    $("#info_view").append("<li> County: " + result[0].county + "</li>");
                    $("#info_view").append("<li> State: " + result[0].state + "</li>");
                    $("#info_view").append("<li> Date of Birth: " + result[0].dob.slice(0, 10) + "</li>");
                    $("#info_view").append("<li> Party affiliation: " + result[0].P_aff + "</li>");
                    $("#info_view").append("<li> Precinct: " + result[0].precinct + "</li>");
                    $("#info_view").append("<li> Phone Number: " + result[0].phone + "</li>");
                    $("#info_view").append("<li> ZIP Code: " + result[0].zip + "</li>");
                    $("#info_view").append("<li> Registration Date: " + result[0].registration.slice(0, 10) + "</li>");
                });

        }</script>
}

